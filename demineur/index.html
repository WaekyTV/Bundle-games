<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le D√©mineur</title>
    <style>
        /* Th√®me sombre coh√©rent */
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a2e;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            user-select: none;
        }
        h1 {
            color: #00ff99; /* Vert n√©on */
        }
        
        #controls {
            margin-bottom: 20px;
        }

        /* La grille de jeu */
        #game-board {
            display: inline-grid;
            /* Le nombre de colonnes sera d√©fini par JS */
            grid-gap: 1px;
            background-color: #2e2e4d;
            border: 5px solid #6441a5;
            padding: 5px;
        }
        
        /* Les cases individuelles */
        .cell {
            width: 30px;
            height: 30px;
            background-color: #444; /* Non d√©couvert */
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.1s;
            font-size: 0.9em;
        }
        
        /* Cases d√©couvertes */
        .cell.discovered {
            background-color: #ccc;
            color: #1a1a2e;
            cursor: default;
        }
        .cell.discovered.empty {
            background-color: #eee;
        }
        
        /* Styles sp√©cifiques aux num√©ros */
        .c1 { color: blue; }
        .c2 { color: green; }
        .c3 { color: red; }
        .c4 { color: darkblue; }
        .c5 { color: darkred; }
        .c6 { color: teal; }
        .c7 { color: black; }
        .c8 { color: gray; }
        
        /* Drapeaux et Bombes */
        .cell.flag {
            background-color: #6441a5;
            color: #FFDC00; /* Jaune */
            font-size: 1.5em;
        }
        .cell.mine {
            background-color: #FF4136; /* Rouge (explosion) */
            font-size: 1.5em;
        }

        #status {
            font-size: 1.5em;
            margin: 20px 0;
            min-height: 30px;
            color: #00ff99;
        }
        
        /* Boutons et lien */
        button {
            background-color: #00ff99;
            border: none;
            color: #1a1a2e;
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        a {
            display: inline-block;
            margin-top: 15px;
            color: #00ff99;
            text-decoration: none;
            font-size: 1.1em;
        }
    </style>
</head>
<body>

    <h1>Le D√©mineur</h1>
    
    <div id="controls">
        <button id="restartButton">Nouveau Jeu (10x10, 20 mines)</button>
    </div>
    
    <div id="status">Cliquez pour commencer. Le clic droit pose un drapeau (üö©).</div>
    
    <div id="game-board"></div>
    
    <a href="../index.html">Retour au menu</a>

    <script>
        const ROWS = 10;
        const COLS = 10;
        const MINES = 20;

        const boardElement = document.getElementById('game-board');
        const statusElement = document.getElementById('status');
        const restartButton = document.getElementById('restartButton');

        let board = []; // Tableau 2D avec la logique (mine, nombre)
        let gameActive = true;
        let cellsLeft; // Cases non min√©es √† d√©couvrir

        // Emp√™che le menu contextuel du clic droit d'appara√Ætre
        document.addEventListener('contextmenu', e => e.preventDefault());

        // --- Fonctions d'Initialisation ---

        function initializeGame() {
            boardElement.innerHTML = '';
            boardElement.style.gridTemplateColumns = `repeat(${COLS}, 30px)`;
            
            board = [];
            gameActive = true;
            cellsLeft = ROWS * COLS - MINES;
            statusElement.textContent = `üö© Mines : ${MINES}`; // Affiche le total de mines
            // ... (fin de fonction)

            // Cr√©ation de la grille logique et visuelle
            for (let r = 0; r < ROWS; r++) {
                board[r] = [];
                for (let c = 0; c < COLS; c++) {
                    // Logic Data: 0=vide, -1=mine
                    board[r][c] = {
                        isMine: false,
                        count: 0,
                        isDiscovered: false,
                        isFlagged: false,
                        element: createCellElement(r, c)
                    };
                    boardElement.appendChild(board[r][c].element);
                }
            }

            placeMines();
            calculateNumbers();
        }

        function createCellElement(r, c) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.dataset.row = r;
            cell.dataset.col = c;
            // √âv√©nements pour le jeu
            cell.addEventListener('click', handleLeftClick);
            cell.addEventListener('contextmenu', handleRightClick); // Clic droit
            return cell;
        }

        // Place les mines al√©atoirement
        function placeMines() {
            let minesPlaced = 0;
            while (minesPlaced < MINES) {
                const r = Math.floor(Math.random() * ROWS);
                const c = Math.floor(Math.random() * COLS);

                if (!board[r][c].isMine) {
                    board[r][c].isMine = true;
                    // board[r][c].element.textContent = 'üí£'; // D√©commenter pour tricher
                    minesPlaced++;
                }
            }
        }

        // Calcule le nombre de mines autour de chaque case
        function calculateNumbers() {
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    if (!board[r][c].isMine) {
                        let count = 0;
                        getNeighbors(r, c).forEach(([nr, nc]) => {
                            if (board[nr][nc].isMine) {
                                count++;
                            }
                        });
                        board[r][c].count = count;
                    }
                }
            }
        }

        // Retourne les coordonn√©es des cases voisines valides
        function getNeighbors(r, c) {
            const neighbors = [];
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    if (dr === 0 && dc === 0) continue; // Pas la case elle-m√™me
                    const nr = r + dr;
                    const nc = c + dc;

                    // V√©rifie si la case est dans la grille
                    if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                        neighbors.push([nr, nc]);
                    }
                }
            }
            return neighbors;
        }

        // --- Fonctions de Jeu ---

        // Clic gauche (D√©couvrir)
        function handleLeftClick(e) {
            if (!gameActive) return;

            const r = parseInt(e.target.dataset.row);
            const c = parseInt(e.target.dataset.col);
            const cell = board[r][c];

            if (cell.isDiscovered || cell.isFlagged) return;

            if (cell.isMine) {
                // D√©faite
                cell.element.classList.add('mine');
                cell.element.textContent = 'üí•';
                revealAllMines();
                endGame(false);
            } else {
                discover(r, c);
                checkWin();
            }
        }

        // Clic droit (Drapeau)
        function handleRightClick(e) {
            if (!gameActive) return;

            const r = parseInt(e.target.dataset.row);
            const c = parseInt(e.target.dataset.col);
            const cell = board[r][c];

            if (cell.isDiscovered) return;

            // Ajoute/Retire le drapeau
            cell.isFlagged = !cell.isFlagged;
            cell.element.classList.toggle('flag');
            cell.element.textContent = cell.isFlagged ? 'üö©' : '';
            
            // --- NOUVEAU : Mise √† jour du statut des mines restantes (classique) ---
            let flagsPlaced = Array.from(document.querySelectorAll('.cell.flag')).length;
            let minesRemaining = MINES - flagsPlaced;
            statusElement.textContent = `üö© Mines : ${minesRemaining}`; 
            // -------------------------------------------------------------------
        }

        // D√©couvre une case et propage si c'est vide (r√©cursif)
        function discover(r, c) {
            const cell = board[r][c];
            if (r < 0 || r >= ROWS || c < 0 || c >= COLS || cell.isDiscovered || cell.isFlagged || cell.isMine) {
                return;
            }

            cell.isDiscovered = true;
            cell.element.classList.add('discovered');
            cellsLeft--;

            if (cell.count > 0) {
                // Si c'est un num√©ro
                cell.element.textContent = cell.count;
                cell.element.classList.add(`c${cell.count}`);
            } else {
                // Si c'est vide, on propage
                cell.element.classList.add('empty');
                getNeighbors(r, c).forEach(([nr, nc]) => discover(nr, nc));
            }
        }

        // R√©v√®le toutes les bombes
        function revealAllMines() {
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const cell = board[r][c];
                    if (cell.isMine && !cell.isDiscovered) {
                        cell.element.classList.add('mine');
                        cell.element.textContent = 'üí£';
                    }
                }
            }
        }

        // V√©rifie la victoire
        function checkWin() {
            if (cellsLeft === 0) {
                endGame(true);
            }
        }

        // G√®re la fin de partie
        function endGame(win) {
            gameActive = false;
            if (win) {
                statusElement.textContent = "üèÜ GAGN√â ! Vous avez d√©min√© la zone !";
                // console.log("Le joueur a gagn√© !");
            } else {
                statusElement.textContent = "üíÄ PERDU ! Vous avez fait exploser une mine.";
            }
            // On d√©sactive tous les √©couteurs de clic (en retirant les √©v√©nements)
            Array.from(document.querySelectorAll('.cell')).forEach(cellEl => {
                 cellEl.removeEventListener('click', handleLeftClick);
                 cellEl.removeEventListener('contextmenu', handleRightClick);
            });
        }

        // Lie le bouton Recommencer
        restartButton.addEventListener('click', initializeGame);

        // Lancement du jeu
        initializeGame();
    </script>
</body>
</html>
